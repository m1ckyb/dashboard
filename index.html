<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;600;900&display=swap" rel="stylesheet">
<style>
body {
    font-family: 'Source Code Pro', monospace;
    background-color: #000;
    color: #E5E7EB;
    background-image: radial-gradient(#1F2937 1px, transparent 1px);
    background-size: 15px 15px;
}
.service-link {
    transition: color 0.3s ease, transform 0.2s ease;
    position: relative;
    display: inline-block;
}
.service-link:hover {
    color: white;
    transform: translateX(2px);
}
.status-tooltip {
    font-size: 0.95rem;
    color: green;
    opacity: 0;
    transition: opacity 0.2s ease;
    display: block;
    margin-left: 4px;
}
.service-link:hover .status-tooltip {
    opacity: 1;
}
</style>
</head>
<body class="min-h-screen flex flex-col">

<div class="container mx-auto p-4 sm:p-6 md:p-10 lg:p-16 relative flex-1">

<header class="relative mb-24 md:mb-32">
    <div id="date-element" class="absolute top-0 left-0 text-base md:text-lg text-gray-600 font-black tracking-widest uppercase"></div>
    <div class="absolute top-4 left-2 transform -rotate-3">
        <h1 class="text-6xl md:text-8xl font-black text-gray-200 opacity-80 select-none">Home</h1>
    </div>
    <div class="absolute top-16 left-20 md:top-24 md:left-40">
        <h2 class="text-5xl md:text-7xl font-black text-gray-700 select-none">labᵛ²</h2>
    </div>
</header>

<div id="bookmarks-container" class="absolute top-6 right-6 md:right-10 lg:right-16 text-right"></div>

<main id="dashboard-layout" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-2 md:gap-4 lg:gap-6">
</main>

</div> <!-- End of container -->

<footer class="text-gray-400 text-sm flex justify-between p-4 border-t border-gray-700">
    <div>Forked from <a href="https://github.com/lklynet/dashboard" target="_blank" class="underline hover:text-white">lklynet/dashboard</a></div>
    <div>Vibe coded with ChatGPT</div>
    <div><a href="https://github.com/m1ckyb/dashboard" target="_blank" class="underline hover:text-white">M1ckyb</a></div>
</footer>

<script>
async function loadConfig() {
    try {
        const res = await fetch('config.json');
        if (!res.ok) throw new Error('HTTP error ' + res.status);
        return await res.json();
    } catch (err) {
        console.error('Failed to load config.json', err);

        // Create error banner
        const container = document.querySelector('.container');
        if (container) {
            const banner = document.createElement('div');
            banner.textContent = '⚠️ config.json not found. Please provide a valid configuration file.';
            banner.className = 'bg-red-600 text-white font-bold p-3 mb-4 rounded text-center';
            container.prepend(banner);
        }

        return null;
    }
}

function updateDateTime(showTime, timeFormat) {
    const dateElement = document.getElementById('date-element');
    const now = new Date();
    const month = now.toLocaleString('default', { month: 'short' });
    const day = String(now.getDate()).padStart(2,'0');
    const year = now.getFullYear();

    let time = '';
    if (showTime) {
        if(timeFormat === '12') {
            time = now.toLocaleTimeString([], { hour: 'numeric', minute:'2-digit', second:'2-digit', hour12: true });
        } else {
            time = now.toLocaleTimeString([], { hour: '2-digit', minute:'2-digit', second:'2-digit', hour12: false });
        }
    }

    dateElement.textContent = showTime ? `${month}/${day}/${year} ${time}` : `${month}/${day}/${year}`;
}

function checkPerformance(svc, badge, badgeStyles) {
    if(!badge) return;
    badge.textContent = 'Checking...';
    badge.style.color = badgeStyles.online.text;

    const start = performance.now();
    fetch(svc[1] + "?t=" + new Date().getTime(), {mode:'no-cors', cache:'no-cache'})
        .then(() => {
            const end = performance.now();
            badge.textContent = `${Math.round(end-start)}ms`;
            badge.style.color = badgeStyles.online.text;
        })
        .catch(() => {
            badge.textContent = 'Offline';
            badge.style.color = badgeStyles.offline.text;
        });
}

function renderBookmarks(bookmarks, styles) {
    const container = document.getElementById('bookmarks-container');
    const list = document.createElement('div');
    list.className = 'flex flex-row items-center justify-end space-x-2 md:space-x-4';
    bookmarks.forEach(bm=>{
        const a = document.createElement('a');
        a.href=bm[1]; a.target='_blank'; a.rel='noopener noreferrer';
        a.textContent=bm[0];
        a.className = `text-base ${styles.text} hover:${styles.hover} hover:underline transition-colors duration-200`;
        list.appendChild(a);
    });
    container.appendChild(list);
}

function initializeDashboard(config) {
    const layoutContainer = document.getElementById('dashboard-layout');
    layoutContainer.innerHTML = '';

    const blockClasses = [
        "md:col-span-2 lg:col-span-2",
        "md:col-start-3 lg:col-start-3",
        "md:col-start-1 md:row-start-2 lg:col-start-4 lg:row-start-1"
    ];

    config.services.forEach((cat, idx)=>{
        const wrapper = document.createElement('div');
        wrapper.className = `space-y-1 ${blockClasses[idx] || ''}`;

        const title = document.createElement('h2');
        title.className='text-lg text-gray-600 font-bold tracking-wider';
        title.textContent = `// ${cat.displayName}`;
        wrapper.appendChild(title);

        const list = document.createElement('div');
        list.className='flex flex-col items-start space-y-0.5';

        cat.items.forEach(svc=>{
            const link = document.createElement('a');
            link.href = svc[1]; link.target='_blank'; link.rel='noopener noreferrer';
            link.className = `service-link text-base md:text-lg font-semibold ${config.linkStyles.text} leading-tight`;
            link.textContent = svc[0];

            const badge = document.createElement('span');
            badge.className='status-tooltip';
            badge.textContent = config.enablePerformance ? 'Checking...' : '';
            link.appendChild(badge);

            if(config.enablePerformance){
                link.addEventListener('mouseenter', ()=>checkPerformance(svc,badge,config.badgeStyles));
                setInterval(()=>checkPerformance(svc,badge,config.badgeStyles), config.pingInterval);
            }

            list.appendChild(link);
        });

        wrapper.appendChild(list);
        layoutContainer.appendChild(wrapper);
    });
}

document.addEventListener('DOMContentLoaded', async ()=>{
    const config = await loadConfig();
    if(!config) return;

    updateDateTime(config.showTime, config.timeFormat);
    setInterval(()=>updateDateTime(config.showTime, config.timeFormat), 1000);

    renderBookmarks(config.bookmarks, config.bookmarksStyles);
    initializeDashboard(config);
});
</script>

</body>
</html>
